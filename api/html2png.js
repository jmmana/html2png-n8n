import chromium from "@sparticuz/chromium"; import puppeteer from "puppeteer-core";
export default async function handler(req,res){ try{ const {html="<html><body><h1>Hola</h1></body></html>",width=1080,height=1080,dpr=2,wait="networkidle0"}=(req.method==="POST"?req.body:req.query)||{}; const browser=await puppeteer.launch({args:chromium.args,defaultViewport:{width:parseInt(width),height:parseInt(height),deviceScaleFactor:parseFloat(dpr)},executablePath:await chromium.executablePath(),headless:chromium.headless}); const page=await browser.newPage(); await page.setContent(html,{waitUntil:wait}); const png=await page.screenshot({type:"png"}); await browser.close(); res.setHeader("Content-Type","image/png"); res.setHeader("Cache-Control","no-store"); res.status(200).send(png);} catch(e){res.status(500).json({error:e.message});} }
